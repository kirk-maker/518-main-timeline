<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>518 Main – Parking Timeline</title>
<style>
  :root{
    --ink:#0f172a;         /* slate-900 */
    --muted:#475569;       /* slate-600 */
    --blue:#1d4ed8;        /* blue-700 */
    --blue-soft:#dbeafe;   /* blue-100 */
    --green-soft:#dcfce7;  /* green-100 */
    --amber-soft:#fef3c7;  /* amber-100 */
    --card:#ffffff;
    --line:#e5e7eb;        /* slate-200 */
  }
  html,body{height:100%}
  body{
    margin:0;
    font:18px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
    color:var(--ink);
    background:#fff;
    -webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;
  }
  .wrap{max-width:980px;margin:0 auto;padding:28px 16px 64px}
  header{margin-bottom:10px}
  h1{margin:0 0 6px;font-size:28px;line-height:1.2}
  .sub{color:var(--muted);font-size:15px}

  /* Markdown result area */
  main{margin-top:14px}
  main h2{
    font-size:22px; line-height:1.25; margin:28px 0 8px; padding:8px 0;
    border-bottom:1px solid var(--line);
  }
  /* We’ll wrap parts of the H2 via JS for styling */
  .date-chip{font-weight:900;color:var(--blue)}
  .desc-chip{font-weight:800;color:var(--muted)}
  /* H3 (if any) */
  main h3{font-size:18px;margin:18px 0 8px}

  /* Ordered lists (exhibits / points) */
  ol{padding-left:24px;margin:8px 0 20px}
  ol>li{
    background:var(--card);
    border:1px solid var(--line);
    border-left:4px solid var(--blue);
    border-radius:10px;
    padding:10px 12px;
    margin:10px 0;
    list-style-position:outside;
  }
  /* Gentle color cues by position (1,2,3, then loop) */
  ol>li:nth-child(3n+1){ background:var(--blue-soft) }
  ol>li:nth-child(3n+2){ background:var(--green-soft) }
  ol>li:nth-child(3n){   background:var(--amber-soft) }

  /* Links */
  a{color:var(--blue);text-decoration:underline;text-underline-offset:2px}
  a:hover{text-decoration-thickness:2px}

  /* TOC */
  .toc{
    border:1px solid var(--line); background:#f8fafc; padding:10px 12px;
    border-radius:12px; margin:12px 0 18px;
  }
  .toc h2{font-size:16px;margin:0 0 6px;border:0;padding:0;color:var(--muted)}
  .toc a{margin-right:12px;font-size:14px}
  @media (max-width:640px){
    body{font-size:17px}
    h1{font-size:24px}
    main h2{font-size:20px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>518 Main Street — Parking Timeline</h1>
      <div class="sub">Readable, color-coded, and link-friendly. Edit only <code>timeline.md</code>.</div>
    </header>

    <div class="toc" id="toc" hidden>
      <h2>Jump to date</h2>
      <nav id="toc-links"></nav>
    </div>

    <main id="content">
      <div style="border:1px solid var(--line);border-radius:10px;padding:12px;">
        Loading timeline… If this remains, add <code>timeline.md</code> at the repo root.
      </div>
    </main>
  </div>

  <!-- Lightweight Markdown renderer (Marked) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" crossorigin="anonymous"></script>
  <script>
    // Fetch timeline.md from the same site; try gh-pages then main
    const BRANCHES = ["gh-pages","main"];
    const REPO_PATH = ""; // root
    const FILE = "timeline.md";

    function tz(a){ try { return encodeURI(a).replace(/#/g,"%23"); } catch { return a; } }
    function fixLinks(root){
      root.querySelectorAll("a[href]").forEach(a=>{
        a.href = tz(a.getAttribute("href"));
        a.target = "_blank"; a.rel = "noopener";
      });
    }
    function buildTOC(root){
      const tocWrap = document.getElementById("toc");
      const nav = document.getElementById("toc-links");
      nav.innerHTML = "";
      let n=0;
      root.querySelectorAll("h2").forEach(h=>{
        const id = h.id || h.textContent.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");
        h.id = id;
        const a = document.createElement("a");
        a.href = "#"+id; a.textContent = h.textContent.trim();
        nav.appendChild(a); n++;
      });
      tocWrap.hidden = n===0;
    }
    // Make dates & descriptions pop:
    // Split "YYYY-MM-DD — description" into colored spans
    function styleDates(root){
      root.querySelectorAll("h2").forEach(h=>{
        const t = h.textContent;
        const m = t.split("—");
        if(m.length>=2){
          const date = m[0].trim();
          const desc = m.slice(1).join("—").trim();
          h.innerHTML = `<span class="date-chip">${date}</span> — <span class="desc-chip">${desc}</span>`;
        }else{
          h.innerHTML = `<span class="date-chip">${t.trim()}</span>`;
        }
      });
    }

    async function loadMD(){
      const mount = document.getElementById("content");
      let md = null;
      for (const b of BRANCHES){
        const url = `${location.origin}${location.pathname.replace(/index\\.html?$/,'')}${REPO_PATH}${FILE}`;
        // We use relative fetch; if your file is present, this succeeds regardless of branch
        try{
          const res = await fetch("./"+FILE, {cache:"no-store"});
          if(res.ok){ md = await res.text(); break; }
        }catch(e){}
        // Fallback to raw if needed (cross-origin ok on GitHub Pages)
        try{
          const parts = location.pathname.split("/").filter(Boolean);
          // e.g. /518-main-timeline/ -> user/project
          const project = parts[0] || "518-main-timeline";
          const user = location.hostname.split(".")[0] || "kirk-maker";
          const raw = `https://raw.githubusercontent.com/${user}/${project}/${b}/${FILE}`;
          const res2 = await fetch(raw, {cache:"no-store"});
          if(res2.ok){ md = await res2.text(); break; }
        }catch(e){}
      }
      if(!md){
        mount.innerHTML = `<div style="border:1px solid var(--line);border-radius:10px;padding:12px;">
          Could not find <code>${FILE}</code>. Add it to your repo root and refresh.
        </div>`;
        return;
      }
      marked.setOptions({breaks:true,mangle:false,headerIds:true});
      mount.innerHTML = marked.parse(md);

      // Post-process for UX
      fixLinks(mount);
      styleDates(mount);
      buildTOC(mount);

      // Light polish for lists: if a section has an h2 then ol, it’s likely “exhibits”
      // Already styled via CSS nth-child. Nothing else required.
    }
    loadMD();
  </script>
</body>
</html>
